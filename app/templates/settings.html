{% extends "base.html" %}
{% block title %}Settings{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4">Settings</h1>

    <!-- Add this link to your navigation bar or profile page -->
    <a href="{{ url_for('views.settings') }}" class="btn btn-outline-secondary">Settings</a>

    <!-- Update User Information -->
    <form id="update-info-form" method="POST">
        <h3>Update Information</h3>
        <div class="mb-3">
            <label for="username" class="form-label">Username</label>
            <input type="text" class="form-control" id="username" name="username" value="{{ user.username }}" required>
        </div>
        <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
        </div>
        <button type="submit" class="btn btn-primary" name="action" value="update_info">Update Info</button>
    </form>

    <hr>

    <!-- Update Password -->
    <form id="update-password-form" method="POST">
        <h3>Change Password</h3>
        <div class="mb-3">
            <label for="current_password" class="form-label">Current Password</label>
            <input type="password" class="form-control" id="current_password" name="current_password" required>
        </div>
        <div class="mb-3">
            <label for="new_password" class="form-label">New Password</label>
            <input type="password" class="form-control" id="new_password" name="new_password" required>
        </div>
        <button type="submit" class="btn btn-warning" name="action" value="update_password">Change Password</button>
    </form>

    <hr>

    <!-- Delete Account -->
    <form id="delete-account-form" method="POST">
        <h3>Delete Account</h3>
        <p class="text-danger">Warning: This action cannot be undone.</p>
        <button type="submit" class="btn btn-danger" name="action" value="delete_account">Delete Account</button>
    </form>
</div>

<script>
    // Handle form submissions with fetch to provide better user feedback
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', event => {
            event.preventDefault();
            const formData = new FormData(form);
            fetch('/settings', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    if (form.id === 'delete-account-form') {
                        window.location.href = '/';
                    }
                } else {
                    alert(data.error || 'An error occurred.');
                }
            })
            .catch(error => console.error('Error:', error));
        });
    });
</script>
{% endblock %}