{% extends "base.html" %}
{% block title %}{{ selected_user.username }}'s Profile{% endblock %}

{% block content %}
<div class="container mt-5">
    <!-- User Stats Section -->
    <div class="dashboard-header mb-4">
        <div class="profile-info d-flex align-items-center">
            <img src="{{ url_for('static', filename=selected_user.profile_photo or 'default_profile.jpg') }}" 
                 alt="{{ selected_user.username }}" 
                 class="rounded-circle" 
                 style="width: 100px; height: 100px; object-fit: cover; margin-right: 20px;">
            <div>
                <h1>{{ selected_user.username }}'s Profile</h1>
                <p>Statistics based on their reviews.</p>
                <!-- Show Level Badge -->
                <span class="badge badge-level level-{{ user_level }}">Level {{ user_level }}</span>
                <!-- Follow/Unfollow Button -->
                {% if user.id != selected_user.id %}
                    <button id="follow-btn"
                        class="btn {% if is_following %}btn-danger{% else %}btn-success{% endif %}">
                        {% if is_following %}Unfollow{% else %}Follow{% endif %}
                    </button>
                    {% if follows_me and not is_following %}
                        <span class="badge bg-info">Follows you</span>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>

    <div class="stats-grid mb-5">
        <div class="card stat-card">
            <h3 class="card-title">üå∂Ô∏è Spiciness</h3>
            <div class="progress custom-progress">
                <div class="progress-bar bg-danger" style="width: {{ stats.spiciness | default(0) }}%;"></div>
            </div>
            <p>{{ stats.spiciness | default(0) }}% spicy dishes rated</p>
        </div>

        <div class="card stat-card">
            <h3 class="card-title">ü§§ Deliciousness</h3>
            <div class="progress custom-progress">
                <div class="progress-bar bg-success" style="width: {{ stats.deliciousness | default(0) }}%;"></div>
            </div>
            <p>{{ stats.deliciousness | default(0) }}% delicious dishes rated</p>
        </div>

        <div class="card stat-card">
            <h3 class="card-title">üí∞ Value</h3>
            <div class="progress custom-progress">
                <div class="progress-bar bg-warning" style="width: {{ stats.value | default(0) }}%;"></div>
            </div>
            <p>{{ stats.value | default(0) }}% value-rated dishes</p>
        </div>

        <div class="card stat-card">
            <h3 class="card-title">üçΩÔ∏è Plating</h3>
            <div class="progress custom-progress">
                <div class="progress-bar bg-info" style="width: {{ stats.plating | default(0) }}%;"></div>
            </div>
            <p>{{ stats.plating | default(0) }}% plating-rated dishes</p>
        </div>
    </div>

    <div class="card stat-card">
        <h3 class="card-title">‚≠ê Overall Average Rating</h3>
        <div class="progress custom-progress">
            <div class="progress-bar bg-primary" style="width: {{ overall_average_rating | default(0) }}%;"></div>
        </div>
        <p>{{ overall_average_rating | default(0) }}% average rating across all reviews</p>
    </div>

    <!-- User Posts Section -->
    <h2 class="text-center mt-5">Posts by {{ selected_user.username }}</h2>
    <div class="staggered-grid mt-4">
        {% for post in posts %}
        <div class="review-card-modern">
            {% if post.image %}
            <div class="review-image-modern">
                <img src="{{ url_for('static', filename=post.image) }}" alt="{{ post.Resturaunt }}">
            </div>
            {% endif %}
            <div class="review-header-modern">
                <h5>{{ post.Resturaunt }}</h5>
                <p>{{ post.Review }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<script>
document.getElementById('follow-btn')?.addEventListener('click', function() {
    const isFollowing = this.classList.contains('btn-danger');
    fetch(`/${isFollowing ? 'unfollow' : 'follow'}/{{ selected_user.id }}`, {method: 'POST'})
        .then(res => res.json())
        .then(data => {
            if (data.success) location.reload();
        });
});
</script>
{% endblock %}