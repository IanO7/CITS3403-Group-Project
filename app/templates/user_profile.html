{% extends "base.html" %}
{% block title %}{{ selected_user.username }}'s Profile{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/badge.css') }}">
{% endblock %}

{% block content %}
<div class="container mt-5">
    <!-- User Stats Section -->
    <div class="dashboard-header mb-4">
        <div class="profile-info d-flex align-items-center">
            {# Only render avatar if it exists #}
            {% if selected_user.profileImage %}
            <img src="{{ url_for('views.uploaded_file', filename=selected_user.profileImage) }}" 
                 alt="{{ selected_user.username }}" 
                 class="profileImage" 
                 style="width: 100px; height: 100px; object-fit: cover; margin-right: 20px;">
            {% endif %}
            <div> 
                <h1>
                    {{ selected_user.username }}
                    <span class="badge badge-level level-{{ selected_user.level }}">Level {{ selected_user.level }}</span>
                </h1>
                <p>Statistics based on their reviews.</p>
            </div>
        </div>
    </div>

    <div class="stats-grid mb-5">
        <div class="card stat-card">
            <h3 class="card-title">ğŸŒ¶ï¸ Spiciness</h3>
            <div class="progress custom-progress">
                <div class="progress-bar bg-danger" style="width: {{ stats.spiciness | default(0) }}%;"></div>
            </div>
            <p>{{ stats.spiciness | default(0) }}% spicy dishes rated</p>
        </div>

        <div class="card stat-card">
            <h3 class="card-title">ğŸ¤¤ Deliciousness</h3>
            <div class="progress custom-progress">
                <div class="progress-bar bg-success" style="width: {{ stats.deliciousness | default(0) }}%;"></div>
            </div>
            <p>{{ stats.deliciousness | default(0) }}% delicious dishes rated</p>
        </div>

        <div class="card stat-card">
            <h3 class="card-title">ğŸ’° Value</h3>
            <div class="progress custom-progress">
                <div class="progress-bar bg-warning" style="width: {{ stats.value | default(0) }}%;"></div>
            </div>
            <p>{{ stats.value | default(0) }}% value-rated dishes</p>
        </div>

        <div class="card stat-card">
            <h3 class="card-title">ğŸ½ï¸ Service</h3>
            <div class="progress custom-progress">
                <div class="progress-bar bg-info" style="width: {{ stats.service | default(0) }}%;"></div>
            </div>
            <p>{{ stats.service | default(0) }}% service-rated dishes</p>
        </div>
    </div>

    <div class="card stat-card">
        <h3 class="card-title">â­ Overall Average Rating</h3>
        <div class="progress custom-progress">
            <div class="progress-bar bg-primary" style="width: {{ overall_average_rating | default(0) }}%;"></div>
        </div>
        <p>{{ overall_average_rating | default(0) }}% average rating across all reviews</p>
    </div>

    <!-- User Posts Section -->
    <h2 class="text-center mt-5">Posts by {{ selected_user.username }}</h2>
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
        {% for review in posts %}
            {% set show_actions = False %}
            {% include "post.html" with context %}
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='JS/my_friends.js') }}"></script>
{% endblock %}
