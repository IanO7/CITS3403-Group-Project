{% extends "base.html" %}
{% block title %}My Stats Dashboard{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='general_styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">

<div class="dashboard-container">
    <!-- Welcome Section -->
    <div class="dashboard-header">
        <div class="profile-info">
            <img src="{{ url_for('static', filename='Images/profile-placeholder.png') }}" alt="Profile Picture" class="profile-img">
            <div>
                <h1>Welcome back, <span class="user-name">{{ user.username }}</span>!</h1>
                <p>Your personalized food journey dashboard.</p>
            </div>
        </div>
    </div>

    <h1 class="text-center mb-4">Statistics for {{ user.username }}</h1>

    <!-- Statistics Section -->
    <div class="stats-grid">
        <!-- Taste Stats -->
        <div class="card stat-card">
            <h3 class="card-title">ğŸŒ¶ï¸ Spiciness</h3>
            <div class="progress custom-progress">
                <div class="progress-bar bg-danger" style="width: {{ stats.spiciness | default(0) }}%;"></div>
            </div>
            <p>{{ stats.spiciness | default(0) }}% spicy dishes rated</p>
        </div>

        <div class="card stat-card">
            <h3 class="card-title">ğŸ¤¤ Deliciousness</h3>
            <div class="progress custom-progress">
                <div class="progress-bar bg-success" style="width: {{ stats.deliciousness | default(0) }}%;"></div>
            </div>
            <p>{{ stats.deliciousness | default(0) }}% delicious dishes rated</p>
        </div>

        <div class="card stat-card">
            <h3 class="card-title">ğŸ’° Value</h3>
            <div class="progress custom-progress">
                <div class="progress-bar bg-warning" style="width: {{ stats.value | default(0) }}%;"></div>
            </div>
            <p>{{ stats.value | default(0) }}% value-rated dishes</p>
        </div>

        <div class="card stat-card">
            <h3 class="card-title">ğŸ½ï¸ Plating</h3>
            <div class="progress custom-progress">
                <div class="progress-bar bg-info" style="width: {{ stats.plating | default(0) }}%;"></div>
            </div>
            <p>{{ stats.plating | default(0) }}% plating-rated dishes</p>
        </div>
    </div>

    <!-- Overall Average Rating -->
    <div class="card stat-card mt-4">
        <h3 class="card-title">â­ Overall Average Rating</h3>
        <div class="progress custom-progress">
            <div class="progress-bar bg-primary" style="width: {{ overall_average_rating | default(0) }}%;"></div>
        </div>
        <p>{{ overall_average_rating | default(0) }}% average rating across all reviews</p>
    </div>

    <!-- Recommended Food-->
    <div class="card stat-card mt-4">
        <h3 class="card-title">Today, I will be eating...</h3>
        <p id="recommended-food">Loading recommendations...</p>
        <input type="text" id="search-food" placeholder="Search for your favourite food" class="form-control mb-3">
        <button id="get-recommendation" class="btn btn-primary">Get Recommendation</button>
    </div>

    <!-- Charts Section -->
    <div class="charts-grid">
        <div class="card chart-card">
            <h3 class="card-title">ğŸ´ Food Eaten/Reviewed</h3>
            <canvas id="foodChart"></canvas>
        </div>
        <div class="card chart-card">
            <h3 class="card-title">ğŸŒ Favorite Cuisine</h3>
            <canvas id="cuisineChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Example Chart.js setup
    const foodChartCtx = document.getElementById('foodChart').getContext('2d');
    const foodChart = new Chart(foodChartCtx, {
        type: 'doughnut',
        data: {
            labels: ['Spicy', 'Delicious', 'Value', 'Plating'],
            datasets: [{
                data: [{{ stats.spiciness }}, {{ stats.deliciousness }}, {{ stats.value }}, {{ stats.plating }}],
                backgroundColor: ['#DF6F1B', '#5F8D3B', '#8E5F2B', '#6E3A14']
            }]
        }
    });

    // Add similar setups for cuisineChart and ratingChart

    document.getElementById('get-recommendation').addEventListener('click', () => {
        const spiciness = {{ stats.spiciness | default(50) }};
        const deliciousness = {{ stats.deliciousness | default(50) }};
        const value = {{ stats.value | default(50) }};
        const plating = {{ stats.plating | default(50) }};
        const overall = {{ overall_average_rating | default(50) }};

        fetch(`/recommend_food?spiciness=${spiciness}&deliciousness=${deliciousness}&value=${value}&plating=${plating}&overall=${overall}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const recommendations = data.recommendations;
                    const recommendedFood = recommendations.map(food => `
                        <div>
                            <h5>${food.restaurant}</h5>
                            <p>Spiciness: ${food.spiciness}, Deliciousness: ${food.deliciousness}, Value: ${food.value}, Plating: ${food.plating}, Overall: ${food.overall}</p>
                        </div>
                    `).join('');
                    document.getElementById('recommended-food').innerHTML = recommendedFood;
                } else {
                    document.getElementById('recommended-food').innerText = 'No recommendations found.';
                }
            })
            .catch(error => console.error('Error:', error));
    });
</script>
{% endblock %}