{% extends "base.html" %} {% block title %} post {% endblock %} 

{% block content %}
<div class="d-flex justify-content-center mt-5">
    <form method="POST">
        <div class="form-group">
            <label for="Resturaunt">Restaurant Name</label>
            <input type="text" class="form-control" id="Resturaunt" name="Resturaunt" required>
        </div>
        <div class="form-group">
            <label for="location">Location</label>
            <input type="text" class="form-control" id="location" name="location" placeholder="Enter a location or landmark" required>
            <ul id="location-suggestions" class="list-group mt-2" style="display: none;"></ul>
        </div>
        <div class="form-grou">
            <label for="Stars" class="form-label">Stars</label>
            <input type="number" name="Stars" id="Stars" min="1" max="5" value="0" required>
        </div>
        <div id="map" style="height: 300px; margin-top: 10px;"></div>
        <div class="form-group">
            <label for="Spiciness">Spiciness</label>
            <input type="range" class="form-range" id="Spiciness" name="Spiciness" min="0" max="100" value="50" oninput="updateValue('spicinessValue', this.value)">
            <span id="spicinessValue" class="range-value">50</span>
        </div>
        <div class="form-group">
            <label for="Deliciousness">Deliciousness</label>
            <input type="range" class="form-range" id="Deliciousness" name="Deliciousness" min="0" max="100" value="50" oninput="updateValue('deliciousnessValue', this.value)">
            <span id="deliciousnessValue" class="range-value">50</span>
        </div>
        <div class="form-group">
            <label for="Value">Value</label>
            <input type="range" class="form-range" id="Value" name="Value" min="0" max="100" value="50" oninput="updateValue('valueValue', this.value)">
            <span id="valueValue" class="range-value">50</span>
        </div>
        <div class="form-group">
            <label for="Plating">Plating</label>
            <input type="range" class="form-range" id="Plating" name="Plating" min="0" max="100" value="50" oninput="updateValue('platingValue', this.value)">
            <span id="platingValue" class="range-value">50</span>
        </div>
        <div class="form-group">
            <label for="Review">Review</label>
            <textarea class="form-control" id="Review" name="Review" rows="3" required></textarea>
        </div>
        <div class="form-group">
            <label for="image">Image URL</label>
            <input type="file" class="form-control" id="image" name="image" placeholder="Enter an image URL">
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</div>

<style>
    .form-range {
        width: 100%;
        appearance: none;
        height: 8px;
        background: #ddd;
        border-radius: 5px;
        outline: none;
        transition: background 0.3s;
    }

    .form-range::-webkit-slider-thumb {
        appearance: none;
        width: 20px;
        height: 20px;
        background: #007bff;
        border-radius: 50%;
        cursor: pointer;
        transition: background 0.3s;
    }

    .form-range::-webkit-slider-thumb:hover {
        background: #0056b3;
    }

    .range-value {
        display: inline-block;
        margin-left: 10px;
        font-weight: bold;
        color: #333;
    }
</style>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script>
    function updateValue(spanId, value) {
        document.getElementById(spanId).textContent = value;
    }
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const locationInput = document.getElementById('location');
        const suggestionsBox = document.getElementById('location-suggestions');
        const map = L.map('map').setView([0, 0], 2); // Default map view
        const marker = L.marker([0, 0]).addTo(map);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        let debounceTimeout;

        // Fetch location suggestions from Nominatim with debouncing
        locationInput.addEventListener('input', () => {
            const query = locationInput.value.trim();
            if (query.length < 3) {
                suggestionsBox.style.display = 'none';
                return;
            }

            // Debounce to prevent excessive API calls
            clearTimeout(debounceTimeout);
            debounceTimeout = setTimeout(() => {
                fetch(`https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&namedetails=1&q=${encodeURIComponent(query)}`)
                    .then(response => response.json())
                    .then(data => {
                        suggestionsBox.innerHTML = '';
                        if (data.length > 0) {
                            data.forEach(location => {
                                const displayName = location.namedetails?.name || location.display_name;
                                const li = document.createElement('li');
                                li.textContent = displayName;
                                li.classList.add('list-group-item');
                                li.addEventListener('click', () => {
                                    locationInput.value = displayName;
                                    suggestionsBox.style.display = 'none';
                                    map.setView([location.lat, location.lon], 15);
                                    marker.setLatLng([location.lat, location.lon]);
                                });
                                suggestionsBox.appendChild(li);
                            });
                            suggestionsBox.style.display = 'block';
                        } else {
                            suggestionsBox.style.display = 'none';
                        }
                    })
                    .catch(error => console.error('Error fetching location suggestions:', error));
            }, 300); // 300ms debounce delay
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', (event) => {
            if (!locationInput.contains(event.target) && !suggestionsBox.contains(event.target)) {
                suggestionsBox.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}
